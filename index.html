<html>
    <head>
        <meta charset="utf-8">
        <title>[FFXIV] FF14 Hunter</title>
        <script src="https://apis.google.com/js/api.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-nanum-barun-gothic@1.0.0/nanumbarungothic.min.css">
    </head>
    <body>
        <script>
            gapi.load('client', initClient);
            var alphabet = ["A","B","C","D","E","F","G","H","I","J","K","L","M","N"];
            function initClient() {
                var API_KEY = 'AIzaSyAxFo4vumR9TLX-0-5zUaUbzXdY7mzDhOk';
                var CLIENT_ID = '17741540562-l3u3pptf45khhkpv103e7737imama9b1.apps.googleusercontent.com';

                var SCOPE = 'https://www.googleapis.com/auth/spreadsheets.readonly';

                gapi.client.init({
                    'apiKey': API_KEY,
                    'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
                    }).then(function() {
                    makeApiCall();
                });
            }
            function makeApiCall() {
                var params = {
                spreadsheetId: '1p-X4AaYuLH2ounIzjKPBYeyFtzlHUgLRh8Xqt3aMaAY',
                range: 'B17:H30',
                majorDimension: 'ROWS',
                };

                var request = gapi.client.sheets.spreadsheets.values.get(params);
                request.then(function(response) {
                    // TODO: Change code below to process the `response` object:
//                    console.log(response.result);
//                    console.log(response.result.values[0]);
                    updateTable(response.result.values);
                }, function(reason) {
                        console.error('error: ' + reason.result.error.message);
                });
            }
            function updateTable(data) {
//                console.log(data);
                //0:(7) ["저지드라", "기계병정 슬립킨크스", "", " 07일 14:04 ~ 07일 16:24", "", "", "66%"]
                //(4) ["드라구름", "아가 ▶실종◀ ", "", " 07일 07:10 ~      실종     "]
                
                var i;
                for(i = 0; i < data.length; i++)
                {
                    if(data[i].length == 7)
                        {
                            document.getElementById(String(alphabet[i]+1)).innerHTML = data[i][0];
                            document.getElementById(String(alphabet[i]+2)).innerHTML = data[i][1];
                            var percentCell = document.getElementById(String(alphabet[i]+3));
                            var percentData = data[i][6];
                            if(percentData.length > 3) {
//                                percentCell.style.fontWeight = 'bold';
                                percentCell.style.backgroundColor = "rgba(140,38,5,0.95)";
                            }
                            percentCell.innerHTML = percentData;
                        }
                    else if(data[i].length == 4)
                        {// 실종마물
                            document.getElementById(String(alphabet[i]+1)).innerHTML = data[i][0];
                            document.getElementById(String(alphabet[i]+2)).innerHTML = data[i][1].replace(" ▶실종◀","");
                            document.getElementById(String(alphabet[i]+3)).innerHTML = "실종";
                        }
                }
            }
            
            setInterval(initClient, 30000);
        </script>
<!--    <div><input type="button" onclick="initClient();" value="수동갱신" /></div>-->
    <div style="width: 280px">
        <table id="huntTable">
        <colgroup>
        <col style="width: 35%;">
        <col style="width: 60%;">
        <col style="width: 5%;">
        </colgroup>
          <tr>
            <th id="head" colspan="3">A급 마물 시간표</th>
          </tr>
          <tr>
            <td id='A1'></td>
            <td id='A2'></td>
            <td id='A3'></td>
          </tr>
          <tr>
            <td id='B1'></td>
            <td id='B2'></td>
            <td id='B3'></td>
          </tr>
          <tr>
            <td id='C1'></td>
            <td id='C2'></td>
            <td id='C3'></td>
          </tr>
          <tr>
            <td id='D1'></td>
            <td id='D2'></td>
            <td id='D3'></td>
          </tr>
          <tr>
            <td id='E1'></td>
            <td id='E2'></td>
            <td id='E3'></td>
          </tr>
          <tr>
            <td id='F1'></td>
            <td id='F2'></td>
            <td id='F3'></td>
          </tr>
          <tr>
            <td id='G1'></td>
            <td id='G2'></td>
            <td id='G3'></td>
          </tr>
          <tr>
            <td id='H1'></td>
            <td id='H2'></td>
            <td id='H3'></td>
          </tr>
          <tr>
            <td id='I1'></td>
            <td id='I2'></td>
            <td id='I3'></td>
          </tr>
          <tr>
            <td id='J1'></td>
            <td id='J2'></td>
            <td id='J3'></td>
          </tr>
          <tr>
            <td id='K1'></td>
            <td id='K2'></td>
            <td id='K3'></td>
          </tr>
          <tr>
            <td id='L1'></td>
            <td id='L2'></td>
            <td id='L3'></td>
          </tr>
          <tr>
            <td id='M1'></td>
            <td id='M2'></td>
            <td id='M3'></td>
          </tr>
          <tr>
            <td id='N1'></td>
            <td id='N2'></td>
            <td id='N3'></td>
          </tr>
        </table>
    </div>
    </body>
</html>
